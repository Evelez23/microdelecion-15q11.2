<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reportar caso | Microdeleci√≥n 15q11.2</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ESTILOS AQU√ç MISMO */
    .form-status { padding: 15px; border-radius: 8px; margin: 15px 0; display: none; }
    .form-status.success { background: rgba(99, 230, 190, 0.2); border: 1px solid #63e6be; color: #63e6be; }
    .form-status.error { background: rgba(255, 107, 107, 0.2); border: 1px solid #ff6b6b; color: #ff6b6b; }
    .required::after { content: " *"; color: #ff6b6b; }
    .form-help { font-size: 0.9em; color: var(--muted); margin-top: 5px; }
    
    /* ESTILOS DE FORMULARIO */
    .form-container { background: rgba(255, 255, 255, 0.03); border-radius: var(--border-radius); padding: 24px; margin: 20px 0; }
    fieldset { border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--border-radius); padding: 20px; margin-bottom: 20px; background: rgba(255, 255, 255, 0.02); }
    legend { padding: 0 10px; color: var(--primary); font-weight: 600; font-size: 1.1em; }
    .form-group { margin-bottom: 20px; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .form-group label { display: block; margin-bottom: 8px; color: var(--text); font-weight: 600; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border-radius: var(--border-radius); border: 1px solid rgba(255, 255, 255, 0.1); background: var(--card); color: var(--text); font-family: inherit; font-size: 1em; transition: border-color 0.3s ease; }
    .form-group textarea { min-height: 80px; resize: vertical; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 2px rgba(110, 168, 254, 0.2); }
    
    @media (max-width: 768px) {
      .form-grid { grid-template-columns: 1fr; }
      .form-container { padding: 16px; }
      fieldset { padding: 15px; }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="inner">
      <div class="brand">
        <img class="logo" src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/main/img/logo%20micro1.webp" alt="Logo Microdeleci√≥n 15q11.2">
        <div>Microdeleci√≥n 15q11.2</div>
      </div>
      <div class="nav-links">
        <a href="index.html">Inicio</a>
        <a href="genetica.html">Gen√©tica</a> 
        <a href="casos.html">Casos</a>
        <a href="estadisticas.html">Estad√≠sticas</a>
        <a href="resumen.html">Resumen</a>
        <a href="recursos.html">Recursos</a>
        <a href="comentarios.html">Comentarios</a>
        <a class="btn-agregar" href="formulario.html">Reportar caso</a>
      </div>
    </div>
  </nav>

  <section class="container">
    <h1>Reportar un caso</h1>
    <p class="subtitle">Comparte informaci√≥n sobre un caso de microdeleci√≥n 15q11.2 para ayudar a nuestra comunidad</p>

    <div class="panel">
      <h2>üìã Formulario de reporte</h2>
      <p>Utiliza el siguiente formulario para reportar un nuevo caso. Los campos marcados con <span class="required"></span> son obligatorios.</p>
      
      <div id="form-status" class="form-status"></div>
      
      <form id="casoForm" class="form-container">
        <!-- Informaci√≥n b√°sica -->
        <fieldset>
          <legend>üë§ Informaci√≥n b√°sica</legend>
          
          <div class="form-group">
            <label for="nombre" class="required">Nombre o seud√≥nimo:</label>
            <input type="text" id="nombre" name="nombre" placeholder="C√≥mo te gustar√≠a que te llamemos" required>
            <div class="form-help">Tu privacidad es importante. Usa un nombre que te identifique.</div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="edad" class="required">Edad:</label>
              <input type="number" id="edad" name="edad" min="0" max="120" placeholder="Edad en a√±os" required>
            </div>

            <div class="form-group">
              <label for="genero" class="required">G√©nero:</label>
              <select id="genero" name="genero" required>
                <option value="">Seleccionar...</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="localizacion">üìç Ubicaci√≥n (pa√≠s/ciudad):</label>
            <input type="text" id="localizacion" name="localizacion" placeholder="Ej: Madrid, Espa√±a">
            <div class="form-help">Nos ayuda a entender la distribuci√≥n geogr√°fica.</div>
          </div>
        </fieldset>

        <!-- Informaci√≥n m√©dica -->
        <fieldset>
          <legend>üè• Informaci√≥n m√©dica</legend>
          
          <div class="form-group">
            <label for="sintomas" class="required">üìä S√≠ntomas principales:</label>
            <textarea id="sintomas" name="sintomas" rows="3" placeholder="Ej: TEA, hipoton√≠a, retraso en el lenguaje, epilepsia, TDAH..." required></textarea>
            <div class="form-help">Separa los s√≠ntomas con comas. S√© tan espec√≠fico como puedas.</div>
          </div>

          <div class="form-group">
            <label for="gravedad" class="required">‚öñÔ∏è Nivel de afectaci√≥n:</label>
            <select id="gravedad" name="gravedad" required>
              <option value="">Seleccionar...</option>
              <option value="Leve">Leve (vida independiente con apoyos m√≠nimos)</option>
              <option value="Moderado">Moderado (necesita apoyo significativo)</option>
              <option value="Severo">Severo (dependencia total o casi total)</option>
              <option value="No especificado">No estoy seguro/a</option>
            </select>
          </div>

          <div class="form-group">
            <label for="pruebas">üîç Pruebas realizadas:</label>
            <textarea id="pruebas" name="pruebas" rows="2" placeholder="Ej: Array gen√©tico, EEG, resonancia magn√©tica, cariotipo..."></textarea>
          </div>
        </fieldset>

        <!-- Tratamientos y terapias -->
        <fieldset>
          <legend>üíä Tratamientos y terapias</legend>
          
          <div class="form-group">
            <label for="medicamentos">üíä Medicamentos:</label>
            <textarea id="medicamentos" name="medicamentos" rows="2" placeholder="Ej: Risperidona, magnesio, antiepil√©pticos, metilfenidato..."></textarea>
            <div class="form-help">Incluye dosis si las conoces.</div>
          </div>

          <div class="form-group">
            <label for="terapias">üèãÔ∏è Terapias recibidas:</label>
            <textarea id="terapias" name="terapias" rows="2" placeholder="Ej: Logopedia, fisioterapia, psicoterapia, integraci√≥n sensorial..."></textarea>
            <div class="form-help">Frecuencia y duraci√≥n de las terapias.</div>
          </div>
        </fieldset>

        <!-- Informaci√≥n adicional -->
        <fieldset>
          <legend>üí≠ Informaci√≥n adicional</legend>
          
          <div class="form-group">
            <label for="desafios">üîÑ Desaf√≠os principales:</label>
            <textarea id="desafios" name="desafios" rows="3" placeholder="¬øQu√© desaf√≠os enfrentas d√≠a a d√≠a? Ej: comunicaci√≥n, movilidad, alimentaci√≥n, sue√±o..."></textarea>
          </div>

          <div class="form-group">
            <label for="comentarios">üí° Comentarios adicionales:</label>
            <textarea id="comentarios" name="comentarios" rows="3" placeholder="Algo m√°s que quieras compartir con la comunidad..."></textarea>
            <div class="form-help">Logros, consejos, cosas que te han funcionado...</div>
          </div>
        </fieldset>

        <!-- Consentimiento -->
        <div class="form-group">
          <label>
            <input type="checkbox" id="privacidad" required>
            ‚úÖ Acepto que esta informaci√≥n se comparta de forma <strong>an√≥nima</strong> con la comunidad para fines de apoyo e investigaci√≥n
          </label>
        </div>

        <button type="submit" class="button">üì§ Enviar reporte</button>
      </form>
    </div>

    <div class="grid-2">
      <div class="panel">
        <h2>ü§ù ¬øPor qu√© reportar un caso?</h2>
        <ul>
          <li><strong>Ayuda a la comunidad:</strong> Tu experiencia puede ayudar a otras familias.</li>
          <li><strong>Contribuye a la investigaci√≥n:</strong> Los datos agregados ayudan a entender mejor esta condici√≥n.</li>
          <li><strong>Recibe apoyo:</strong> Al compartir tu caso, puedes conectar con otras familias en situaciones similares.</li>
          <li><strong>Mant√©n el anonimato:</strong> Toda la informaci√≥n personal se mantendr√° confidencial.</li>
        </ul>
      </div>

      <div class="panel">
        <h2>üîí Pol√≠tica de privacidad</h2>
        <p><strong>Tu privacidad es nuestra prioridad:</strong></p>
        <ul>
          <li>‚úÖ Nunca publicaremos informaci√≥n personal identificable</li>
          <li>‚úÖ Los datos se muestran de forma agregada y an√≥nima</li>
          <li>‚úÖ Puedes solicitar eliminar tu informaci√≥n en cualquier momento</li>
          <li>‚úÖ Utilizamos los datos solo con fines de investigaci√≥n y apoyo comunitario</li>
        </ul>
      </div>
    </div>
  </section>

  <footer class="footer">¬© 2025 | Formulario seguro y confidencial - Comunidad de Familias 15q11.2</footer>

  <!-- Supabase CDN -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <!-- TODO EL JAVASCRIPT AQU√ç MISMO -->
  <script>
    // Configuraci√≥n de Supabase
    const SUPABASE_URL = 'https://bfzyrfsfptkyrnyogxuy.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmenlyZnNmcHRreXJueW9neHV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNDI1MzIsImV4cCI6MjA3MTkxODUzMn0.VGe5dJRt6oJfUPKS8mvuy539CKyv7kTt6u8lRmBQi5A';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Mostrar mensaje de estado
    function showMessage(message, type) {
      const statusDiv = document.getElementById('form-status');
      if (!statusDiv) return;
      
      statusDiv.textContent = message;
      statusDiv.className = `form-status ${type}`;
      statusDiv.style.display = 'block';
      
      statusDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Manejar env√≠o del formulario
    document.getElementById('casoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      
      // Validar checkbox de privacidad
      if (!document.getElementById('privacidad').checked) {
        showMessage('Debes aceptar la pol√≠tica de privacidad para enviar el formulario', 'error');
        return;
      }
      
      // Obtener datos del formulario
      const formData = {
        nombre: document.getElementById('nombre').value.trim(),
        edad: parseInt(document.getElementById('edad').value) || 0,
        genero: document.getElementById('genero').value,
        localizacion: document.getElementById('localizacion').value.trim(),
        sintomas: document.getElementById('sintomas').value.trim(),
        gravedad: document.getElementById('gravedad').value,
        pruebas: document.getElementById('pruebas').value.trim(),
        medicamentos: document.getElementById('medicamentos').value.trim(),
        terapias: document.getElementById('terapias').value.trim(),
        desafios: document.getElementById('desafios').value.trim(),
        comentarios: document.getElementById('comentarios').value.trim()
      };
      
      // Validar datos requeridos
      if (!formData.nombre || !formData.edad || !formData.genero || !formData.sintomas || !formData.gravedad) {
        showMessage('Por favor, completa todos los campos obligatorios', 'error');
        return;
      }
      
      // Deshabilitar bot√≥n y mostrar carga
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';
      
      try {
        // Insertar en Supabase
        const { data, error } = await supabase
          .from('casos')
          .insert([formData])
          .select();
        
        if (error) throw error;
        
        // √âxito
        showMessage('‚úÖ ¬°Reporte enviado con √©xito! Gracias por contribuir a nuestra comunidad.', 'success');
        
        // Limpiar formulario
        this.reset();
        
        // Redirigir despu√©s de 3 segundos
        setTimeout(() => {
          window.location.href = 'comentarios.html';
        }, 3000);
        
      } catch (error) {
        console.error('Error:', error);
        showMessage('‚ùå Error al enviar el reporte. Por favor, intenta nuevamente.', 'error');
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    });

    // Validaci√≥n en tiempo real
    document.querySelectorAll('input[required], select[required], textarea[required]').forEach(input => {
      input.addEventListener('blur', function() {
        if (!this.value.trim()) {
          this.style.borderColor = '#ff6b6b';
        } else {
          this.style.borderColor = '';
        }
      });
    });
  </script>
</body>
</html>
