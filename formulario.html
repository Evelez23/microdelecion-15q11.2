<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reportar caso | MicrodeleciÃ³n 15q11.2</title>
  <meta name="description" content="Formulario para reportar nuevos casos de microdeleciÃ³n 15q11.2">
  <link rel="stylesheet" href="styles.css">
  <style>
    .form-status {
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      display: none;
    }
    .form-status.success {
      background: rgba(99, 230, 190, 0.2);
      border: 1px solid #63e6be;
      color: #63e6be;
    }
    .form-status.error {
      background: rgba(255, 107, 107, 0.2);
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
    }
    .required::after {
      content: " *";
      color: #ff6b6b;
    }
    .form-help {
      font-size: 0.9em;
      color: var(--muted);
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="inner">
      <div class="brand">
        <img class="logo" src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/main/img/logo%20micro1.webp" alt="Logo MicrodeleciÃ³n 15q11.2">
        <div>MicrodeleciÃ³n 15q11.2</div>
      </div>
      <div class="nav-links">
        <a href="index.html">Inicio</a>
        <a href="genetica.html">GenÃ©tica</a> 
        <a href="casos.html">Casos</a>
        <a href="estadisticas.html">EstadÃ­sticas</a>
        <a href="resumen.html">Resumen</a>
        <a href="recursos.html">Recursos</a>
        <a href="comentarios.html">Comentarios</a>
        <a class="btn-agregar" href="formulario.html">Reportar caso</a>
      </div>
    </div>
  </nav>

  <section class="container">
    <h1>Reportar un caso</h1>
    <p class="subtitle">Comparte informaciÃ³n sobre un caso de microdeleciÃ³n 15q11.2 para ayudar a nuestra comunidad</p>

    <div class="panel">
      <h2>ğŸ“‹ Formulario de reporte</h2>
      <p>Utiliza el siguiente formulario para reportar un nuevo caso. Los campos marcados con <span class="required"></span> son obligatorios.</p>
      
      <div id="form-status" class="form-status"></div>
      
      <form id="casoForm" class="form-container">
        <!-- InformaciÃ³n bÃ¡sica -->
        <fieldset>
          <legend>ğŸ‘¤ InformaciÃ³n bÃ¡sica</legend>
          
          <div class="form-group">
            <label for="nombre" class="required">Nombre o seudÃ³nimo:</label>
            <input type="text" id="nombre" name="nombre" placeholder="CÃ³mo te gustarÃ­a que te llamemos" required>
            <div class="form-help">Tu privacidad es importante. Usa un nombre que te identifique.</div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="edad" class="required">Edad:</label>
              <input type="number" id="edad" name="edad" min="0" max="120" placeholder="Edad en aÃ±os" required>
            </div>

            <div class="form-group">
              <label for="genero" class="required">GÃ©nero:</label>
              <select id="genero" name="genero" required>
                <option value="">Seleccionar...</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="No binario">No binario</option>
                <option value="Prefiero no decir">Prefiero no decir</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="localizacion">ğŸ“ UbicaciÃ³n (paÃ­s/ciudad):</label>
            <input type="text" id="localizacion" name="localizacion" placeholder="Ej: Madrid, EspaÃ±a">
            <div class="form-help">Nos ayuda a entender la distribuciÃ³n geogrÃ¡fica.</div>
          </div>
        </fieldset>

        <!-- InformaciÃ³n mÃ©dica -->
        <fieldset>
          <legend>ğŸ¥ InformaciÃ³n mÃ©dica</legend>
          
          <div class="form-group">
            <label for="sintomas" class="required">ğŸ“Š SÃ­ntomas principales:</label>
            <textarea id="sintomas" name="sintomas" rows="3" placeholder="Ej: TEA, hipotonÃ­a, retraso en el lenguaje, epilepsia, TDAH..." required></textarea>
            <div class="form-help">Separa los sÃ­ntomas con comas. SÃ© tan especÃ­fico como puedas.</div>
          </div>

          <div class="form-group">
            <label for="gravedad" class="required">âš–ï¸ Nivel de afectaciÃ³n:</label>
            <select id="gravedad" name="gravedad" required>
              <option value="">Seleccionar...</option>
              <option value="Leve">Leve (vida independiente con apoyos mÃ­nimos)</option>
              <option value="Moderado">Moderado (necesita apoyo significativo)</option>
              <option value="Severo">Severo (dependencia total o casi total)</option>
              <option value="No especificado">No estoy seguro/a</option>
            </select>
          </div>

          <div class="form-group">
            <label for="pruebas">ğŸ” Pruebas realizadas:</label>
            <textarea id="pruebas" name="pruebas" rows="2" placeholder="Ej: Array genÃ©tico, EEG, resonancia magnÃ©tica, cariotipo..."></textarea>
          </div>
        </fieldset>

        <!-- Tratamientos y terapias -->
        <fieldset>
          <legend>ğŸ’Š Tratamientos y terapias</legend>
          
          <div class="form-group">
            <label for="medicamentos">ğŸ’Š Medicamentos:</label>
            <textarea id="medicamentos" name="medicamentos" rows="2" placeholder="Ej: Risperidona, magnesio, antiepilÃ©pticos, metilfenidato..."></textarea>
            <div class="form-help">Incluye dosis si las conoces.</div>
          </div>

          <div class="form-group">
            <label for="terapias">ğŸ‹ï¸ Terapias recibidas:</label>
            <textarea id="terapias" name="terapias" rows="2" placeholder="Ej: Logopedia, fisioterapia, psicoterapia, integraciÃ³n sensorial..."></textarea>
            <div class="form-help">Frecuencia y duraciÃ³n de las terapias.</div>
          </div>
        </fieldset>

        <!-- InformaciÃ³n adicional -->
        <fieldset>
          <legend>ğŸ’­ InformaciÃ³n adicional</legend>
          
          <div class="form-group">
            <label for="desafios">ğŸ”„ DesafÃ­os principales:</label>
            <textarea id="desafios" name="desafios" rows="3" placeholder="Â¿QuÃ© desafÃ­os enfrentas dÃ­a a dÃ­a? Ej: comunicaciÃ³n, movilidad, alimentaciÃ³n, sueÃ±o..."></textarea>
          </div>

          <div class="form-group">
            <label for="comentarios">ğŸ’¡ Comentarios adicionales:</label>
            <textarea id="comentarios" name="comentarios" rows="3" placeholder="Algo mÃ¡s que quieras compartir con la comunidad..."></textarea>
            <div class="form-help">Logros, consejos, cosas que te han funcionado...</div>
          </div>
        </fieldset>

        <!-- Consentimiento -->
        <div class="form-group">
          <label>
            <input type="checkbox" id="privacidad" required>
            âœ… Acepto que esta informaciÃ³n se comparta de forma <strong>anÃ³nima</strong> con la comunidad para fines de apoyo e investigaciÃ³n
          </label>
        </div>

        <button type="submit" class="button">ğŸ“¤ Enviar reporte</button>
      </form>
    </div>

    <div class="grid-2">
      <div class="panel">
        <h2>ğŸ¤ Â¿Por quÃ© reportar un caso?</h2>
        <ul>
          <li><strong>Ayuda a la comunidad:</strong> Tu experiencia puede ayudar a otras familias.</li>
          <li><strong>Contribuye a la investigaciÃ³n:</strong> Los datos agregados ayudan a entender mejor esta condiciÃ³n.</li>
          <li><strong>Recibe apoyo:</strong> Al compartir tu caso, puedes conectar con otras familias en situaciones similares.</li>
          <li><strong>MantÃ©n el anonimato:</strong> Toda la informaciÃ³n personal se mantendrÃ¡ confidencial.</li>
        </ul>
      </div>

      <div class="panel">
        <h2>ğŸ”’ PolÃ­tica de privacidad</h2>
        <p><strong>Tu privacidad es nuestra prioridad:</strong></p>
        <ul>
          <li>âœ… Nunca publicaremos informaciÃ³n personal identificable</li>
          <li>âœ… Los datos se muestran de forma agregada y anÃ³nima</li>
          <li>âœ… Puedes solicitar eliminar tu informaciÃ³n en cualquier momento</li>
          <li>âœ… Utilizamos los datos solo con fines de investigaciÃ³n y apoyo comunitario</li>
        </ul>
      </div>
    </div>
  </section>

  <footer class="footer">Â© 2025 | Formulario seguro y confidencial - Comunidad de Familias 15q11.2</footer>

  <!-- Supabase CDN -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    // Inicializar Supabase
    const SUPABASE_URL = 'https://bfzyrfsfptkyrnyogxuy.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJmenlyZnNmcHRreXJueW9neHV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzNDI1MzIsImV4cCI6MjA3MTkxODUzMn0.VGe5dJRt6oJfUPKS8mvuy539CKyv7kTt6u8lRmBQi5A';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // Mostrar mensaje de estado
    function showMessage(message, type) {
      const statusDiv = document.getElementById('form-status');
      statusDiv.textContent = message;
      statusDiv.className = `form-status ${type}`;
      statusDiv.style.display = 'block';
      
      // Scroll to message
      statusDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Manejar envÃ­o del formulario
    document.getElementById('casoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitButton = this.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      
      // Validar checkbox de privacidad
      if (!document.getElementById('privacidad').checked) {
        showMessage('Debes aceptar la polÃ­tica de privacidad para enviar el formulario', 'error');
        return;
      }
      
      // Obtener datos del formulario
      const formData = {
        nombre: document.getElementById('nombre').value.trim(),
        edad: parseInt(document.getElementById('edad').value) || 0,
        genero: document.getElementById('genero').value,
        localizacion: document.getElementById('localizacion').value.trim(),
        sintomas: document.getElementById('sintomas').value.trim(),
        gravedad: document.getElementById('gravedad').value,
        pruebas: document.getElementById('pruebas').value.trim(),
        medicamentos: document.getElementById('medicamentos').value.trim(),
        terapias: document.getElementById('terapias').value.trim(),
        desafios: document.getElementById('desafios').value.trim(),
        comentarios: document.getElementById('comentarios').value.trim()
      };
      
      // Validar datos requeridos
      if (!formData.nombre || !formData.edad || !formData.genero || !formData.sintomas || !formData.gravedad) {
        showMessage('Por favor, completa todos los campos obligatorios', 'error');
        return;
      }
      
      // Deshabilitar botÃ³n y mostrar carga
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';
      
      try {
        // Insertar en Supabase
        const { data, error } = await supabase
          .from('casos')
          .insert([formData])
          .select();
        
        if (error) {
          throw new Error(error.message);
        }
        
        // Ã‰xito
        showMessage('âœ… Â¡Reporte enviado con Ã©xito! Gracias por contribuir a nuestra comunidad. Tu informaciÃ³n ayuda a otras familias.', 'success');
        
        // Limpiar formulario
        this.reset();
        
        // Redirigir despuÃ©s de 3 segundos
        setTimeout(() => {
          window.location.href = 'comentarios.html';
        }, 3000);
        
      } catch (error) {
        console.error('Error:', error);
        showMessage('âŒ Error al enviar el reporte: ' + error.message, 'error');
      } finally {
        // Restaurar botÃ³n
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    });

    // ValidaciÃ³n en tiempo real
    document.querySelectorAll('input[required], select[required], textarea[required]').forEach(input => {
      input.addEventListener('blur', function() {
        if (!this.value.trim()) {
          this.style.borderColor = '#ff6b6b';
        } else {
          this.style.borderColor = '';
        }
      });
    });
  </script>
</body>
</html>
