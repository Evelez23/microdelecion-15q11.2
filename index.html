<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Microdeleci√≥n 15q11.2 ‚Äì Portal Comunitario</title>
  <link rel="stylesheet" href="styles.css">
  <script defer src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="scripts.js"></script>
  <style>
    /* Estilos adicionales para mejorar la responsividad */
    @media (max-width: 768px) {
      .hero-flex {
        flex-direction: column;
      }
      
      .hero-content {
        order: 2;
      }
      
      .hero-image {
        order: 1;
        margin-bottom: 2rem;
      }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="inner">
      <div class="brand">
        <img class="logo" src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/refs/heads/main/img/logo%20micro1.webp" alt="Logo Microdeleci√≥n 15q11.2">
        <div>Microdeleci√≥n 15q11.2</div>
        </div>
            <div class="nav-links">
                <a href="index.html">Inicio</a>
                <a href="genetica.html">Gen√©tica</a> 
                <a href="casos.html">Casos</a>
                <a href="estadisticas.html">Estad√≠sticas</a>
                <a href="resumen.html">Resumen</a>
                <a href="recursos.html" class="active">Recursos</a>
                <a class="btn-agregar" href="formulario.html">Reportar caso</a>
            </div>
    </div>
  </nav>

  <section class="hero">
    <div class="container hero-flex">
      <div class="hero-content">
        <h1>Microdeleci√≥n 15q11.2 ‚Äì Comunidad de Familias</h1>
        <p>Plataforma colaborativa para documentar y comprender la microdeleci√≥n 15q11.2 <strong>desde la perspectiva de las familias afectadas</strong>.</p>
        
        <div class="testimonio">
          <h2>‚ÄúNo estamos solos‚Äù</h2>
          <p>Aunque cada ni√±o es un mundo y la enfermedad nos sorprende con nuevas curvas, aqu√≠ compartimos el miedo, la rabia y tambi√©n la alegr√≠a de cada peque√±o paso:</p>
          <ul>
            <li>La primera palabra</li>
            <li>El primer bocado</li>
            <li>El d√≠a sin crisis</li>
          </ul>
          <p>Lloramos juntos, re√≠mos juntos y, sobre todo, luchamos juntos. Porque somos muchos bajo el mismo gen y, entre todos, <strong>ya sabemos m√°s que los libros</strong>.</p>
        </div>
        
        <div class="cta">
          <a class="button" href="casos.html">Ver casos</a>
          <a class="button secondary" href="resumen.html">Ver resumen</a>
        </div>
      </div>
      
      <div class="hero-image">
        <img src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/refs/heads/main/img/82526dd8-8147-48ea-88dc-700b6a49ebf8.webp" 
             alt="Mi hijo empujando su caminadora - cada peque√±o paso es una victoria" 
             class="pintura-oleo">
        <p class="pie-foto">Cada peque√±o paso es una victoria - Familia 15q11.2</p>
      </div>
    </div>

    <div class="container">
      <div class="cards" id="kpis"></div>

      <div class="grid-2">
        <div class="panel">
          <h3>Distribuci√≥n por edades</h3>
          <canvas id="chartAges" height="140"></canvas>
        </div>
        <div class="panel">
          <h3>Presencia internacional</h3>
          <div id="paises-container" class="paises-grid">
            <div class="pais-loading">Cargando pa√≠ses...</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="disclaimer">
    <p>üí° <strong>Importante:</strong> Esta plataforma es desarrollada por familias afectadas. La informaci√≥n aqu√≠ compartida tiene fines educativos y de apoyo mutuo, no sustituye el consejo m√©dico profesional.</p>
  </div>

  <footer class="footer">¬© 2025 | Comunidad de Familias 15q11.2</footer>

  <script>
    // Versi√≥n mejorada del c√≥digo JavaScript
    async function loadDataset() {
      // Esta funci√≥n deber√≠a cargar tus datos reales
      // Por ahora devolvemos datos de ejemplo para probar
      return [
        { __origen: "validado", localizacion: "Madrid, Espa√±a", edad: "5" },
        { __origen: "validado", localizacion: "Barcelona", edad: "8" },
        { __origen: "no_validado", localizacion: "Buenos Aires, Argentina", edad: "12" },
        { __origen: "validado", localizacion: "M√©xico DF", edad: "3" },
        { __origen: "validado", localizacion: "No especificada", edad: "15" },
        { __origen: "no_validado", localizacion: "Lima", edad: "7" },
        { __origen: "validado", localizacion: "Santiago de Chile", edad: "19" },
        { __origen: "validado", localizacion: "New York, USA", edad: "22" },
        { __origen: "validado", localizacion: "Par√≠s", edad: "6" },
        { __origen: "validado", localizacion: "Roma", edad: "10" },
        { __origen: "no_validado", localizacion: "Berl√≠n", edad: "14" },
        { __origen: "validado", localizacion: "Tokio", edad: "9" },
        { __origen: "validado", localizacion: "No especificada", edad: "" }
      ];
    }

    async function initIndex() {
      const data = await loadDataset();

      // ---- KPIs ----
      const total = data.length;
      const validados = data.filter(c => c.__origen === "validado").length;
      const noValidados = data.filter(c => c.__origen === "no_validado").length;

      // Pa√≠ses / localizaci√≥n distintos (excluyendo "No especificada")
      const paisesSet = new Set(
        data
          .map(c => (c.localizacion || "").trim())
          .filter(p => p && p.toLowerCase() !== "no especificada")
          .map(lugar => detectarPais(lugar)) // Usamos la funci√≥n mejorada
      );

      // Render de KPIs
      const kpiContainer = document.getElementById("kpis");
      if (kpiContainer) {
        kpiContainer.innerHTML = `
          <div class="panel kpi">
            <h2>${total}</h2>
            <p>Total de casos</p>
          </div>
          <div class="panel kpi">
            <h2>${validados}</h2>
            <p>Casos validados</p>
          </div>
          <div class="panel kpi">
            <h2>${noValidados}</h2>
            <p>Casos no validados</p>
          </div>
          <div class="panel kpi">
            <h2>${paisesSet.size}</h2>
            <p>Pa√≠ses con casos</p>
          </div>
        `;
      }

      // ---- Distribuci√≥n por edades ----
      const buckets = {
        "0-5": 0,
        "6-12": 0,
        "13-18": 0,
        "19+": 0,
        "No especificada": 0
      };

      data.forEach(c => {
        const edad = parseInt(c.edad);
        if (!isNaN(edad)) {
          if (edad <= 5) buckets["0-5"]++;
          else if (edad <= 12) buckets["6-12"]++;
          else if (edad <= 18) buckets["13-18"]++;
          else buckets["19+"]++;
        } else {
          buckets["No especificada"]++;
        }
      });

      // Chart: edades
      const agesEl = document.getElementById("chartAges");
      if (agesEl) {
        const ctxAges = agesEl.getContext("2d");
        new Chart(ctxAges, {
          type: "bar",
          data: {
            labels: Object.keys(buckets),
            datasets: [{
              label: "N√∫mero de casos",
              data: Object.values(buckets),
              backgroundColor: "#6ea8fe"
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
          }
        });
      }

      // ---- Mapa de pa√≠ses ----
      const paisesContainer = document.getElementById("paises-container");
      if (paisesContainer) {
        // Contar casos por pa√≠s detectado
        const paisesCount = {};
        data.forEach(c => {
          const lugar = (c.localizacion || "").trim();
          if (lugar && lugar.toLowerCase() !== "no especificada") {
            const pais = detectarPais(lugar);
            paisesCount[pais] = (paisesCount[pais] || 0) + 1;
          }
        });

        // Ordenar por n√∫mero de casos
        const paisesOrdenados = Object.entries(paisesCount)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 12); // Top 12 pa√≠ses

        if (paisesOrdenados.length > 0) {
          paisesContainer.innerHTML = paisesOrdenados.map(([pais, count]) => {
            const bandera = getBandera(pais);
            const nombrePais = pais.charAt(0).toUpperCase() + pais.slice(1);
            
            return `
              <div class="pais-card">
                <span class="bandera">${bandera}</span>
                <div class="pais-nombre">${nombrePais}</div>
                <div class="pais-casos">${count} caso${count !== 1 ? 's' : ''}</div>
              </div>
            `;
          }).join('');
        } else {
          paisesContainer.innerHTML = '<div class="pais-loading">No hay datos de pa√≠ses disponibles</div>';
        }
      }

      // Animaciones
      if (window.anime) {
        anime({
          targets: '.panel, .pais-card',
          opacity: [0, 1],
          translateY: [20, 0],
          delay: anime.stagger(100),
          duration: 800,
          easing: 'easeOutQuad'
        });
      }
    }

    // Funci√≥n para obtener bandera por pa√≠s
    function getBandera(pais) {
      // Limpiar y normalizar el texto del pa√≠s
      const paisLimpio = pais.toLowerCase()
        .replace(/[^a-z√°√©√≠√≥√∫√º√±\s]/g, '') // Eliminar caracteres especiales
        .trim();
      
      const banderas = {
        // Espa√±a y variantes
        'espa√±a': 'üá™üá∏', 'espana': 'üá™üá∏', 'spain': 'üá™üá∏',
        
        // Latinoam√©rica
        'argentina': 'üá¶üá∑',
        'honduras': 'üá≠üá≥',
        'm√©xico': 'üá≤üáΩ', 'mexico': 'üá≤üáΩ',
        'colombia': 'üá®üá¥',
        'chile': 'üá®üá±',
        'per√∫': 'üáµüá™', 'peru': 'üáµüá™',
        'venezuela': 'üáªüá™',
        'ecuador': 'üá™üá®',
        'uruguay': 'üá∫üáæ',
        'brasil': 'üáßüá∑',
        
        // Resto del mundo
        'estados unidos': 'üá∫üá∏', 'usa': 'üá∫üá∏', 'eeuu': 'üá∫üá∏',
        'canad√°': 'üá®üá¶', 'canada': 'üá®üá¶',
        'francia': 'üá´üá∑',
        'italia': 'üáÆüáπ',
        'alemania': 'üá©üá™',
        'reino unido': 'üá¨üáß', 'inglaterra': 'üá¨üáß',
        'jap√≥n': 'üáØüáµ', 'japon': 'üáØüáµ',
        
        'default': 'üåç'
      };

      // Buscar coincidencias exactas primero
      if (banderas[paisLimpio]) {
        return banderas[paisLimpio];
      }
      
      // Buscar coincidencias parciales
      for (const [key, bandera] of Object.entries(banderas)) {
        if (paisLimpio.includes(key) || key.includes(paisLimpio)) {
          return bandera;
        }
      }
      
      return banderas.default;
    }

    // Funci√≥n mejorada para detectar el pa√≠s desde una ciudad/regi√≥n
    function detectarPais(lugar) {
      if (!lugar) return 'Desconocido';
      
      const lugarLower = lugar.toLowerCase();
      
      // Primero buscar coincidencias directas de pa√≠ses
      const paisesDirectos = [
        'espa√±a', 'espana', 'spain', 'argentina', 'honduras', 
        'm√©xico', 'mexico', 'colombia', 'chile', 'per√∫', 'peru',
        'venezuela', 'ecuador', 'uruguay', 'brasil', 'estados unidos',
        'usa', 'eeuu', 'canad√°', 'canada', 'francia', 'italia', 
        'alemania', 'reino unido', 'inglaterra', 'jap√≥n', 'japon'
      ];
      
      for (const pais of paisesDirectos) {
        if (lugarLower.includes(pais)) {
          return pais;
        }
      }
      
      // Si no encontramos pa√≠s directamente, buscar por ciudades
      const paises = {
        'espa√±a': ['malaga', 'm√°laga', 'madrid', 'barcelona', 'valencia', 'sevilla', 'bilbao', 'granada', 'alicante', 'murcia', 'zaragoza', 'segovia'],
        'argentina': ['buenos aires', 'c√≥rdoba', 'rosario', 'mendoza', 'caba'],
        'honduras': ['tegucigalpa', 'san pedro sula', 'la ceiba'],
        'm√©xico': ['ciudad de m√©xico', 'cdmx', 'guadalajara', 'monterrey', 'canc√∫n'],
        'colombia': ['bogot√°', 'bogota', 'medell√≠n', 'medellin', 'cali', 'barranquilla'],
        'chile': ['santiago', 'valpara√≠so', 'vi√±a del mar'],
        'per√∫': ['lima', 'callao', 'cusco'],
        'venezuela': ['caracas', 'maracaibo', 'valencia'],
        'estados unidos': ['new york', 'los angeles', 'chicago', 'miami', 'texas', 'florida', 'california'],
        'francia': ['par√≠s', 'paris', 'lyon', 'marsella'],
        'italia': ['roma', 'mil√°n', 'milan', 'venecia', 'florencia'],
        'alemania': ['berl√≠n', 'berlin', 'm√∫nich', 'munich', 'hamburgo'],
        'reino unido': ['londres', 'manchester', 'liverpool', 'edimburgo'],
        'jap√≥n': ['tokio', 'osaka', 'kyoto']
      };
      
      // Buscar si el lugar contiene una ciudad de alg√∫n pa√≠s
      for (const [pais, ciudades] of Object.entries(paises)) {
        if (ciudades.some(ciudad => lugarLower.includes(ciudad))) {
          return pais;
        }
      }
      
      // Si no encontramos coincidencias, devolver el texto original pero acortado
      return acortarNombre(lugar);
    }

    // Funci√≥n para acortar nombres largos
    function acortarNombre(pais) {
      const acortamientos = {
        'estados unidos': 'EE.UU.',
        'reino unido': 'R.U.',
        'rep√∫blica dominicana': 'R.D.',
        'default': pais.length > 15 ? pais.substring(0, 12) + '...' : pais
      };

      const paisLower = pais.toLowerCase();
      return acortamientos[paisLower] || acortamientos.default;
    }

    document.addEventListener("DOMContentLoaded", initIndex);
  </script>
</body>
</html>
