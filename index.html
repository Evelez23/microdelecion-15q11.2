<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Microdeleción 15q11.2 – Portal Comunitario</title>
  <link rel="stylesheet" href="styles.css">
  <script defer src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="scripts.js"></script>
  <style>
    /* Estilos adicionales para mejorar la responsividad */
    @media (max-width: 768px) {
      .hero-flex {
        flex-direction: column;
      }
      
      .hero-content {
        order: 2;
      }
      
      .hero-image {
        order: 1;
        margin-bottom: 2rem;
      }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="inner">
      <div class="brand">
        <img class="logo" src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/refs/heads/main/img/logo%20micro1.webp" alt="Logo Microdeleción 15q11.2">
        <div>Microdeleción 15q11.2</div>
        </div>
            <div class="nav-links">
                <a href="index.html">Inicio</a>
                <a href="genetica.html">Genética</a> 
                <a href="casos.html">Casos</a>
                <a href="estadisticas.html">Estadísticas</a>
                <a href="resumen.html">Resumen</a>
                <a href="recursos.html" class="active">Recursos</a>
                <a class="btn-agregar" href="formulario.html">Reportar caso</a>
            </div>
    </div>
  </nav>

  <section class="hero">
    <div class="container hero-flex">
      <div class="hero-content">
        <h1>Microdeleción 15q11.2 – Comunidad de Familias</h1>
        <p>Plataforma colaborativa para documentar y comprender la microdeleción 15q11.2 <strong>desde la perspectiva de las familias afectadas</strong>.</p>
        
        <div class="testimonio">
          <h2>“No estamos solos”</h2>
          <p>Aunque cada niño es un mundo y la enfermedad nos sorprende con nuevas curvas, aquí compartimos el miedo, la rabia y también la alegría de cada pequeño paso:</p>
          <ul>
            <li>La primera palabra</li>
            <li>El primer bocado</li>
            <li>El día sin crisis</li>
          </ul>
          <p>Lloramos juntos, reímos juntos y, sobre todo, luchamos juntos. Porque somos muchos bajo el mismo gen y, entre todos, <strong>ya sabemos más que los libros</strong>.</p>
        </div>
        
        <div class="cta">
          <a class="button" href="casos.html">Ver casos</a>
          <a class="button secondary" href="resumen.html">Ver resumen</a>
        </div>
      </div>
      
      <div class="hero-image">
        <img src="https://raw.githubusercontent.com/Evelez23/microdelecion-15q11.2/refs/heads/main/img/82526dd8-8147-48ea-88dc-700b6a49ebf8.webp" 
             alt="Mi hijo empujando su caminadora - cada pequeño paso es una victoria" 
             class="pintura-oleo">
        <p class="pie-foto">Cada pequeño paso es una victoria - Familia 15q11.2</p>
      </div>
    </div>

    <div class="container">
      <div class="cards" id="kpis"></div>

      <div class="grid-2">
        <div class="panel">
          <h3>Distribución por edades</h3>
          <canvas id="chartAges" height="140"></canvas>
        </div>
        <div class="panel">
          <h3>Presencia internacional</h3>
          <div id="paises-container" class="paises-grid">
            <div class="pais-loading">Cargando países...</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="disclaimer">
    <p>💡 <strong>Importante:</strong> Esta plataforma es desarrollada por familias afectadas. La información aquí compartida tiene fines educativos y de apoyo mutuo, no sustituye el consejo médico profesional.</p>
  </div>

  <footer class="footer">© 2025 | Comunidad de Familias 15q11.2</footer>

  <script>
    // Versión mejorada del código JavaScript
    async function loadDataset() {
      // Esta función debería cargar tus datos reales
      // Por ahora devolvemos datos de ejemplo para probar
      return [
        { __origen: "validado", localizacion: "Madrid, España", edad: "5" },
        { __origen: "validado", localizacion: "Barcelona", edad: "8" },
        { __origen: "no_validado", localizacion: "Buenos Aires, Argentina", edad: "12" },
        { __origen: "validado", localizacion: "México DF", edad: "3" },
        { __origen: "validado", localizacion: "No especificada", edad: "15" },
        { __origen: "no_validado", localizacion: "Lima", edad: "7" },
        { __origen: "validado", localizacion: "Santiago de Chile", edad: "19" },
        { __origen: "validado", localizacion: "New York, USA", edad: "22" },
        { __origen: "validado", localizacion: "París", edad: "6" },
        { __origen: "validado", localizacion: "Roma", edad: "10" },
        { __origen: "no_validado", localizacion: "Berlín", edad: "14" },
        { __origen: "validado", localizacion: "Tokio", edad: "9" },
        { __origen: "validado", localizacion: "No especificada", edad: "" }
      ];
    }

    async function initIndex() {
      const data = await loadDataset();

      // ---- KPIs ----
      const total = data.length;
      const validados = data.filter(c => c.__origen === "validado").length;
      const noValidados = data.filter(c => c.__origen === "no_validado").length;

      // Países / localización distintos (excluyendo "No especificada")
      const paisesSet = new Set(
        data
          .map(c => (c.localizacion || "").trim())
          .filter(p => p && p.toLowerCase() !== "no especificada")
          .map(lugar => detectarPais(lugar)) // Usamos la función mejorada
      );

      // Render de KPIs
      const kpiContainer = document.getElementById("kpis");
      if (kpiContainer) {
        kpiContainer.innerHTML = `
          <div class="panel kpi">
            <h2>${total}</h2>
            <p>Total de casos</p>
          </div>
          <div class="panel kpi">
            <h2>${validados}</h2>
            <p>Casos validados</p>
          </div>
          <div class="panel kpi">
            <h2>${noValidados}</h2>
            <p>Casos no validados</p>
          </div>
          <div class="panel kpi">
            <h2>${paisesSet.size}</h2>
            <p>Países con casos</p>
          </div>
        `;
      }

      // ---- Distribución por edades ----
      const buckets = {
        "0-5": 0,
        "6-12": 0,
        "13-18": 0,
        "19+": 0,
        "No especificada": 0
      };

      data.forEach(c => {
        const edad = parseInt(c.edad);
        if (!isNaN(edad)) {
          if (edad <= 5) buckets["0-5"]++;
          else if (edad <= 12) buckets["6-12"]++;
          else if (edad <= 18) buckets["13-18"]++;
          else buckets["19+"]++;
        } else {
          buckets["No especificada"]++;
        }
      });

      // Chart: edades
      const agesEl = document.getElementById("chartAges");
      if (agesEl) {
        const ctxAges = agesEl.getContext("2d");
        new Chart(ctxAges, {
          type: "bar",
          data: {
            labels: Object.keys(buckets),
            datasets: [{
              label: "Número de casos",
              data: Object.values(buckets),
              backgroundColor: "#6ea8fe"
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
          }
        });
      }

      // ---- Mapa de países ----
      const paisesContainer = document.getElementById("paises-container");
      if (paisesContainer) {
        // Contar casos por país detectado
        const paisesCount = {};
        data.forEach(c => {
          const lugar = (c.localizacion || "").trim();
          if (lugar && lugar.toLowerCase() !== "no especificada") {
            const pais = detectarPais(lugar);
            paisesCount[pais] = (paisesCount[pais] || 0) + 1;
          }
        });

        // Ordenar por número de casos
        const paisesOrdenados = Object.entries(paisesCount)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 12); // Top 12 países

        if (paisesOrdenados.length > 0) {
          paisesContainer.innerHTML = paisesOrdenados.map(([pais, count]) => {
            const bandera = getBandera(pais);
            const nombrePais = pais.charAt(0).toUpperCase() + pais.slice(1);
            
            return `
              <div class="pais-card">
                <span class="bandera">${bandera}</span>
                <div class="pais-nombre">${nombrePais}</div>
                <div class="pais-casos">${count} caso${count !== 1 ? 's' : ''}</div>
              </div>
            `;
          }).join('');
        } else {
          paisesContainer.innerHTML = '<div class="pais-loading">No hay datos de países disponibles</div>';
        }
      }

      // Animaciones
      if (window.anime) {
        anime({
          targets: '.panel, .pais-card',
          opacity: [0, 1],
          translateY: [20, 0],
          delay: anime.stagger(100),
          duration: 800,
          easing: 'easeOutQuad'
        });
      }
    }

    // Función para obtener bandera por país
    function getBandera(pais) {
      // Limpiar y normalizar el texto del país
      const paisLimpio = pais.toLowerCase()
        .replace(/[^a-záéíóúüñ\s]/g, '') // Eliminar caracteres especiales
        .trim();
      
      const banderas = {
        // España y variantes
        'españa': '🇪🇸', 'espana': '🇪🇸', 'spain': '🇪🇸',
        
        // Latinoamérica
        'argentina': '🇦🇷',
        'honduras': '🇭🇳',
        'méxico': '🇲🇽', 'mexico': '🇲🇽',
        'colombia': '🇨🇴',
        'chile': '🇨🇱',
        'perú': '🇵🇪', 'peru': '🇵🇪',
        'venezuela': '🇻🇪',
        'ecuador': '🇪🇨',
        'uruguay': '🇺🇾',
        'brasil': '🇧🇷',
        
        // Resto del mundo
        'estados unidos': '🇺🇸', 'usa': '🇺🇸', 'eeuu': '🇺🇸',
        'canadá': '🇨🇦', 'canada': '🇨🇦',
        'francia': '🇫🇷',
        'italia': '🇮🇹',
        'alemania': '🇩🇪',
        'reino unido': '🇬🇧', 'inglaterra': '🇬🇧',
        'japón': '🇯🇵', 'japon': '🇯🇵',
        
        'default': '🌍'
      };

      // Buscar coincidencias exactas primero
      if (banderas[paisLimpio]) {
        return banderas[paisLimpio];
      }
      
      // Buscar coincidencias parciales
      for (const [key, bandera] of Object.entries(banderas)) {
        if (paisLimpio.includes(key) || key.includes(paisLimpio)) {
          return bandera;
        }
      }
      
      return banderas.default;
    }

    // Función mejorada para detectar el país desde una ciudad/región
    function detectarPais(lugar) {
      if (!lugar) return 'Desconocido';
      
      const lugarLower = lugar.toLowerCase();
      
      // Primero buscar coincidencias directas de países
      const paisesDirectos = [
        'españa', 'espana', 'spain', 'argentina', 'honduras', 
        'méxico', 'mexico', 'colombia', 'chile', 'perú', 'peru',
        'venezuela', 'ecuador', 'uruguay', 'brasil', 'estados unidos',
        'usa', 'eeuu', 'canadá', 'canada', 'francia', 'italia', 
        'alemania', 'reino unido', 'inglaterra', 'japón', 'japon'
      ];
      
      for (const pais of paisesDirectos) {
        if (lugarLower.includes(pais)) {
          return pais;
        }
      }
      
      // Si no encontramos país directamente, buscar por ciudades
      const paises = {
        'españa': ['malaga', 'málaga', 'madrid', 'barcelona', 'valencia', 'sevilla', 'bilbao', 'granada', 'alicante', 'murcia', 'zaragoza', 'segovia'],
        'argentina': ['buenos aires', 'córdoba', 'rosario', 'mendoza', 'caba'],
        'honduras': ['tegucigalpa', 'san pedro sula', 'la ceiba'],
        'méxico': ['ciudad de méxico', 'cdmx', 'guadalajara', 'monterrey', 'cancún'],
        'colombia': ['bogotá', 'bogota', 'medellín', 'medellin', 'cali', 'barranquilla'],
        'chile': ['santiago', 'valparaíso', 'viña del mar'],
        'perú': ['lima', 'callao', 'cusco'],
        'venezuela': ['caracas', 'maracaibo', 'valencia'],
        'estados unidos': ['new york', 'los angeles', 'chicago', 'miami', 'texas', 'florida', 'california'],
        'francia': ['parís', 'paris', 'lyon', 'marsella'],
        'italia': ['roma', 'milán', 'milan', 'venecia', 'florencia'],
        'alemania': ['berlín', 'berlin', 'múnich', 'munich', 'hamburgo'],
        'reino unido': ['londres', 'manchester', 'liverpool', 'edimburgo'],
        'japón': ['tokio', 'osaka', 'kyoto']
      };
      
      // Buscar si el lugar contiene una ciudad de algún país
      for (const [pais, ciudades] of Object.entries(paises)) {
        if (ciudades.some(ciudad => lugarLower.includes(ciudad))) {
          return pais;
        }
      }
      
      // Si no encontramos coincidencias, devolver el texto original pero acortado
      return acortarNombre(lugar);
    }

    // Función para acortar nombres largos
    function acortarNombre(pais) {
      const acortamientos = {
        'estados unidos': 'EE.UU.',
        'reino unido': 'R.U.',
        'república dominicana': 'R.D.',
        'default': pais.length > 15 ? pais.substring(0, 12) + '...' : pais
      };

      const paisLower = pais.toLowerCase();
      return acortamientos[paisLower] || acortamientos.default;
    }

    document.addEventListener("DOMContentLoaded", initIndex);
  </script>
</body>
</html>
